# Вычисление толщины перинейрональной ячейки [![en](https://img.shields.io/badge/en-ru-green.svg)](../en/calculate_perineuronal_cell_depth.md)
Данный файл содержит описание метода вычисления толщины ячейки перинейрональной сети

# Основная идея
Алгоритм работы модуля: 
1. Импорт необходимых библиотек: 
- Torch, torchvision – для работы с нейронными сетями и преобразованиями изображений. 
- OpenCV – для работы с изображениями. 
- SciPy, NumPy – для выполнения численных и статистических вычислений, а также для работы с многомерными массивами. 
- Scikit-learn – для выполнения кластеризации, расчёта расстояний и других статистических методов.
- Pandas – для работы с таблицами и сохранением результатов. 
2. Чтение конфигурации запуска. Функция «calculate_perineuronal_cell_depth()», предназначенная для демонстрации модуля, загружает параметры работы из словаря и входные изображения. Параметры включают используемое устройство (CPU или GPU), путь к весам обученной модели в формате «.pkl» 
3. Инициализация модели. U-Net. Весовые коэффициенты для модели загружаются из предварительно обученного файла весов, указанного в конфигурационном файле. Модель переводится на указанное устройство (CPU или GPU), а также инициализируются преобразования, которые будут проводиться с изображениями. Преобразования включают в себя конвертацию в тензоры и нормализацию с серединой 0.5 и стандартным отклонением 0.5 по умолчанию.
4. Применяется модель U-Net для предсказания масок объектов на каждом изображении.
5. Применяется метод связанных компонент («scipy.ndimage.label») для выделения и фильтрации объектов на основе их размера. 
6. Применяется алгоритм «GaussianMixture» для выделения объектов на основании их формы. 
7. Кластеризация с использованием алгоритма DBSCAN для сегментирования объектов. 

# Демонстрация
Для демонстрации работы модуля используется пример `simple_calculate_perineural_cell_depth.py`, расположенный по следующему пути:
````
<корень_проекта>/examples/simple_calculate_perineural_cell_depth.py
````
Ниже представлен исходный стак изображений, который используется в качестве входных данных:

![raw perineuronal cell depth](/doc/assets/raw_perineuronal_cell_depth.png)    

Результат вычисления толщины ячейки (толщина – это количество точек Z на проекции XY):

![result perineuronal cell depth](/doc/assets/result_perineuronal_cell_depth.png)    
