# Нахождение границ ячейки перинейрональной сети [![en](https://img.shields.io/badge/en-ru-green.svg)](../en/find_perineuronal_cell_area.md)
Данный файл содержит описание метода нахождения границ указанной ячейки

# Основная идея
Алгоритм работы модуля: 
1. Импорт необходимых библиотек: 
- Torch – модуль для реализации алгоритмов глубокого обучения. 
- Torchvisions.transform – модуль для преобразования изображения, нормализации и конвертации в тензоры.
- OpenCV – для обработки изображений.
- NumPy, SciPy – для выполнения математических и морфологических операций над изображениями. 
2. Чтение конфигурации запуска. Функция «find_perineuronal_cells()», предназначенная для демонстрации модуля, загружает параметры работы из словаря и входные изображения. Параметры включают используемое устройство (CPU или GPU), путь к весам обученной модели в формате «.pkl» 
3. Инициализация модели. Основой алгоритма является нейронная сеть на основе архитектуры U-Net. Весовые коэффициенты для модели загружаются из предварительно обученного файла весов, указанного в конфигурационном файле. Модель переводится на указанное устройство (CPU или GPU), а также инициализируются преобразования, которые будут проводиться с изображениями. Преобразования включают в себя конвертацию в тензоры и нормализацию с серединой 0.5 и стандартным отклонением 0.5 по умолчанию.
4. Предобработка данных. Метод «_preprocess_data()» выполняет следующие шаги:
- считывание изображений;
- преобразование изображений в тензоры, используя библиотеку torchvision.transform. Применяются заданные преобразования (нормализация и перевод в тензоры). 
5. Обработка изображений с помощью модели. После предобработки изображения подаются на вход модели, где происходит сегментация. Для каждого изображения сеть предсказывает маску, выделяя область интереса. Прогнозирование выполняется в режиме без градиентов с помощью методы «torch.no_grad()», что оптимизирует вычисления и снижает нагрузку на устройство. 
6. Постобработка результатов. Метод «_postprocess_data()» применяет к сегментированным изображениям пороговое значение, переводя маску в бинарное изображение, где пиксели выше порога становятся – белыми, а ниже порога – черными. 
7. Вычисление метрик
Для каждого бинарного изображения (маски) вычисляются следующие метрики: 
- Площадь объекта, вычисляется с помощью метода «cv2.contourArea()».
- Периметр, который рассчитывается как длина контура объекта с помощью «cv2.arcLength()».

# Демонстрация
Для демонстрации работы модуля используется пример `simple_find_perineural_cell_area`, расположенный по следующему пути:
```
<корень_проекта>/examples/simple_find_perineural_cell_area.py
```
Демонстрационный набор данных находится по следующему пути: 
```
<корень_проекта>/data/microscopic/perineural/cells_stack
```
Ниже представлено одно из исходных входных микроскопических изображений.

![raw find perineuronal cell](/doc/assets/raw_find_perineuronal_cell.png)    

Результат работы модуля - контур ячейки в виде координат – белые пиксели:

![result find perineuronal cell](/doc/assets/result_find_perineuronal_cell.png)

Результаты вычисления площади и периметра ячеек для каждого слоя:

![result find perineuronal cell](/doc/assets/result_find_perineuronal_cell_area.png)